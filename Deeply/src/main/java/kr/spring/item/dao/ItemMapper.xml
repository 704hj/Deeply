<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"   
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">  

<mapper namespace="kr.spring.item.dao.ItemMapper">
	<!-- 상품 등록 -->
	<insert id="insertItem" parameterType="itemVO">
		INSERT INTO shop_item(
			item_num,
			user_num,
			filename,
			item_name,
			item_price,
			item_description,
			item_stock)
		VALUES (
			shop_item_seq.nextval,
			#{user_num},
			#{filename},
			#{item_name},
			#{item_price},
			#{item_description},
			#{item_stock})
	</insert>
	
	<!-- sql태그와 include 태그를 이용해 sql문을 재사용 -->
	<sql id="shopSearch">
	<where>
		<if test="keyword != null and keyword != ''">
			<if test="keyfield == 1">
				name LIKE '%' || #{keyword} || '%'
			</if>
			<if test="keyfield == 2">
				item_name LIKE '%' || #{keyword} || '%'
			</if>
		</if>
	</where>
	</sql>
	
	<sql id="shopOrder">
		<if test="order == 1">
			ORDER BY name DESC
		</if>
		<if test="order == 2">
			ORDER BY item_name DESC
		</if>
	</sql>

	<select id="selectRowCount" parameterType="map" resultType="integer">
		SELECT
			COUNT(*)
		FROM shop_item JOIN auser_detail USING(user_num)
		<include refid="shopSearch"/>
	</select>
	
	<select id="selectList" parameterType="map" resultType="itemVO">
		SELECT
			*
		FROM (SELECT
				a.*,
				rownum rnum
			FROM (SELECT
					item_num,
					user_num,
					name,
					filename,
					item_name,
					item_regdate,
					item_modifydate,
					item_stock,
					item_description,
					item_price
				FROM shop_item
				JOIN duser_detail USING(user_num)
					)a
				)
				WHERE user_num = #{user_num} <!-- 로그인된 사용자의 ID로 필터링 -->
			<![CDATA[
		AND rnum >= #{start} AND rnum <= #{end}
		]]>
	</select>	
	
	<update id="updateItem" parameterType="ItemVO">
		UPDATE shop_item SET 
				user_num = #{user_num},
				filename = #{filename},
				item_name = #{item_name},
				item_price = #{item_price},
				item_description = #{item_description},
				item_stock = #{item_stock},
				item_modifydate = SYSDATE
		WHERE item_num = #{item_num}
	</update>
	 







</mapper>